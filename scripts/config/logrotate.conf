# ダイヤモンドスカイツリー・パールスカイツリーカレンダー ログローテーション設定（logrotate用）
# 
# 使用方法:
# 1. このファイルを /etc/logrotate.d/skytree-photo-planner にコピー
# 2. ログパスを実際の環境に合わせて修正
# 3. logrotate -d /etc/logrotate.d/skytree-photo-planner でテスト
#
# 詳細: man logrotate

/var/log/skytree-photo-planner/*.log {
    # 毎日ローテーション
    daily
    
    # 30日分保持
    rotate 30
    
    # ログファイルが存在しない場合エラーにしない
    missingok
    
    # ファイルサイズが0でもローテーション実行
    notifempty
    
    # 圧縮して保存
    compress
    
    # 最新のローテーションファイルは圧縮しない
    delaycompress
    
    # ローテーション後に新しいログファイルを作成
    create 644 app app
    
    # ローテーション後にサービスを再起動してログファイルを再オープン
    postrotate
        # systemd使用の場合
        /bin/systemctl reload skytree-photo-planner.service > /dev/null 2>&1 || true
        
        # PM2使用の場合
        # /usr/bin/pm2 reload skytree-photo-planner > /dev/null 2>&1 || true
        
        # プロセスにSIGUSR1シグナルを送信してログファイル再オープン
        # /bin/kill -USR1 $(cat /var/run/skytree-photo-planner.pid) > /dev/null 2>&1 || true
    endscript
}

# サイズベースローテーションの例（コメントアウト）
# /var/log/skytree-photo-planner/*.log {
#     size 100M
#     rotate 10
#     compress
#     delaycompress
#     missingok
#     notifempty
#     create 644 app app
# }